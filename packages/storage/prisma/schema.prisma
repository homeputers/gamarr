// Prisma schema for storage module
// This schema uses PostgreSQL database

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Platform {
  id         String     @id @default(cuid())
  name       String     @unique
  extensions String[]
  libraries  Library[]
}

model Library {
  id         String    @id @default(cuid())
  path       String    @unique
  platformId String
  platform   Platform  @relation(fields: [platformId], references: [id])
  artifacts  Artifact[]
}

model Artifact {
  id        String   @id @default(cuid())
  libraryId String
  library   Library  @relation(fields: [libraryId], references: [id])
  path      String
  size      Int
  crc32     String?
  sha1      String?
  format    String?
  multiPartGroup String? @map("multi_part_group")
  releaseId String?
  release   Release? @relation(fields: [releaseId], references: [id])

  @@unique([libraryId, path])
}

model Game {
  id         String    @id @default(cuid())
  title      String
  provider   String
  providerId String
  releases   Release[]

  @@unique([provider, providerId])
}

model Release {
  id       String   @id @default(cuid())
  gameId   String
  game     Game     @relation(fields: [gameId], references: [id])
  region   String?
  language String?
  artifacts Artifact[]
}

